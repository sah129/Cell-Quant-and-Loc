
```{r}
source('src/functions.R')
datasetpath <- 'Datasets/Dummy 1B'
```
Figure 1B: sigma = .3, offset= 0.002, cutoff = 50

```{r, echo = FALSE}
imageset <- read_in_imageset_git1_tiffs(datasetpath)
channels <- read_in_channels_git1(imageset[1,], datasetpath)
img_gray <- convert_to_grayscale_git1(channels)
```
```{r}
t<-thresh(img_gray[,,gfp_channel])
bt <- bwlabel(t)
FB <- computeFeatures.shape(bt)
hist(FB[,"s.perimeter"])
```

```{r}

ct = thresh(img[,,gfp_channel], offset = offset)

cm = bwlabel(ct)
FS = computeFeatures.shape(cm)
sel <- which(FS[,"s.perimeter"] < cutoff)
membranes <-rmObjects(cm, sel)


res <- remove_edge_membranes(membranes, img, channels)





message(paste0("Number of cells detected on first pass: ", length(table(membranes))))

list(removed = res$removed, membranes = res$membranes, FM = res$FM)
```



```{r}
membranes <- detect_membranes_test(img_gray, channels, offset=-1,sigma=-1,cutoff = -1)
```

```{r}
vacuoles <- find_vacuoles(membranes, img_gray, channels)
res <- exclude_and_bind(membranes, vacuoles)
final<-tidy_up(membranes,vacuoles,res)
```




```{r}
get_display_img(df = final$df,
                membranes = final$membranes, 
                col_membranes = 'white', 
                vacuoles = final$vacuoles, 
                col_vacuoles ='yellow', 
                removed = membranes$removed,
                closed_vacuoles = TRUE, 
                img = channels$gfp, 
                showRemoved = FALSE, 
                showMemLabels = TRUE, 
                showVacLabels = FALSE)
```




```{r}
t <- paintObjects(membranes$membranes, tgt = channel(channels$gfp, "asgreen"), col = c("white", "white"))
display(t)
```




```{r}
cells_blurred = gblur(img_gray[,,gfp_channel], sigma = .5)
ct = thresh(cells_blurred, offset = 0.002)

cm = bwlabel(ct)
FS = computeFeatures.shape(cm)
sel <- which(FS[,"s.area"] < 600)
membranes <-rmObjects(cm, sel)
display(membranes)
```















